<div id="wrapper" th:fragment="content">
    <div class="container mt-5">
        <div class="row">     

            <div class="col-md-6">
                <h3 class="mt-4 text-center">π  μΌλ° νμ› λ¦¬μ¤νΈ</h3>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>μ•„μ΄λ””</th>
                            <th>μ΄λ¦„</th>
                            <th>μ΄λ©”μΌ</th>
                            <th>κµ¬λ¶„</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="general : ${GeneralUsers}">
                            <td th:text="${general.userId}"></td>
                            <td th:text="${general.userNm}"></td>
                            <td th:text="${general.email}"></td>
                            <td th:text="${general.role}"></td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(GeneralUsers)}">
                            <td colspan="4" class="text-center">νμ›μ΄ μ—†μµλ‹λ‹¤.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-6">
                <h3 class="mt-4 text-center">κΈ°μ—… νμ› λ¦¬μ¤νΈ</h3>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>μ•„μ΄λ””</th>
                            <th>μ΄λ¦„</th>
                            <th>μƒνΈλ…</th>
                            <th>μ‚¬μ—…μ λ²νΈ</th>
                            <th>κµ¬λ¶„</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="business : ${BusinessUsers}">
                            <td th:text="${business.userId}"></td>
                            <td th:text="${business.userNm}"></td>
                            <td th:text="${business.businessName}"></td>
                            <td th:text="${business.businessNumber}"></td>
                            <td>
                                <div th:if="${business.approvedYn} eq 'N'">
                                    <button class="btn btn-success btn-sm" th:onclick="approveUser([[${business.userId}]])">μΉμΈ</button>
                                    <button class="btn btn-danger btn-sm" th:onclick="rejectUser([[${business.userId}]])">κ±°μ </button>
                                </div>
                                <div th:if="${business.approvedYn} eq 'Y'">μΉμΈ</div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(BusinessUsers)}">
                            <td colspan="4" class="text-center">νμ›μ΄ μ—†μµλ‹λ‹¤.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- μΉμΈ/κ±°μ  AJAX μ²λ¦¬ -->
    <script>
        function approveUser(userId) {
            if (confirm("ν•΄λ‹Ή νμ›μ„ μΉμΈν•μ‹κ² μµλ‹κΉ?")) {      
                fetch(`/admin/approve/` + userId, {
                    method: 'POST',
                    headers: {
                        [csrfHeader]: csrfToken
                    }
                })
                .then(async res => {
                    const msg = await res.text();
                    if (!res.ok) {
                        alert("β μ¤λ¥ λ°μƒ: " + msg);
                        throw new Error(msg); // reload λ§‰κΈ° μ„ν•΄ throw
                    }
                    alert("β… " + msg); // ex: μΉμΈ μ™„λ£
                    location.reload();
                })
                .catch(err => {
                    console.error("fetch μ‹¤ν¨:", err);
                });
            }
        }

        function rejectUser(userId) {
            if (confirm("ν•΄λ‹Ή νμ›μ„ κ±°μ ν•μ‹κ² μµλ‹κΉ?")) {
                fetch(`/admin/reject/` + userId, {
                    method: 'POST',
                    headers: {
                        [csrfHeader]: csrfToken
                    }
                }).then(() => location.reload());
            }
        }
    </script>
</div>
